import{r as s,j as e}from"./index-DP13vB0D.js";function W({onSelectRealTime:f}){const[c,u]=s.useState(null),v={other:e.jsxs("div",{className:"max-w-xs p-2 bg-white border rounded shadow-lg",children:[e.jsx("h3",{className:"font-bold mb-1",children:"Regular Model"}),e.jsx("p",{className:"text-sm",children:"Provides consistent responses with no delay, ideal for structured conversations."})]}),realtime:e.jsxs("div",{className:"max-w-xs p-2 bg-white border rounded shadow-lg",children:[e.jsx("h3",{className:"font-bold mb-1",children:"Real-Time Model"}),e.jsx("p",{className:"text-sm",children:"Responds instantly, adapting tone and speed as you speak, perfect for dynamic, conversational interactions."})]})};return e.jsxs("div",{className:"menu-container flex flex-col items-center justify-center h-screen bg-gray-100",children:[e.jsx("h1",{className:"text-2xl font-bold mb-8",children:"Select Model"}),e.jsxs("div",{className:"menu-options flex gap-4 relative",children:[e.jsxs("div",{className:"relative",children:[e.jsx("button",{className:"menu-button px-6 py-3 bg-gray-400 text-white rounded cursor-not-allowed",disabled:!0,children:"Other Models"}),e.jsx("div",{className:"absolute -top-0.5 -right-1 w-4 h-4 bg-yellow-400 rounded-full flex items-center justify-center cursor-help hover:bg-gray-400 transition-colors",onMouseEnter:()=>u("other"),onMouseLeave:()=>u(null),children:e.jsx("span",{className:"text-gray-600 text-xs",children:"i"})})]}),e.jsxs("div",{className:"relative",children:[e.jsx("button",{className:"menu-button px-6 py-3 bg-blue-600 text-white rounded hover:bg-blue-500",onClick:f,children:"Real-Time Model"}),e.jsx("div",{className:"absolute -top-0.5 -right-1 w-4 h-4 bg-yellow-400 rounded-full flex items-center justify-center cursor-help hover:bg-gray-400 transition-colors",onMouseEnter:()=>u("realtime"),onMouseLeave:()=>u(null),children:e.jsx("span",{className:"text-gray-600 text-xs",children:"i"})})]}),c&&e.jsx("div",{className:"absolute bottom-full left-1/2 -translate-x-1/2 mb-2",children:v[c]})]})]})}function q({config:f,setConfig:c,onCreatePrompt:u,onModelCreate:v}){const[p,w]=s.useState([]);s.useEffect(()=>{async function r(){try{await navigator.mediaDevices.getUserMedia({audio:!0});const x=(await navigator.mediaDevices.enumerateDevices()).filter(g=>g.kind==="audioinput");w(x),x.length>0&&!f.microphoneId&&c(g=>({...g,microphoneId:x[0].deviceId}))}catch(t){console.error("Error accessing microphone devices:",t)}}r()},[c,f.microphoneId]);const y=[{value:"alloy",label:"Alloy"},{value:"ash",label:"Ash"},{value:"ballad",label:"Ballad"},{value:"coral",label:"Coral"},{value:"echo",label:"Echo"},{value:"sage",label:"Sage"},{value:"shimmer",label:"Shimmer"},{value:"verse",label:"Verse"}];return e.jsx("div",{className:"flex items-center justify-center min-h-screen p-4",children:e.jsxs("div",{className:"configuration-container max-w-lg mx-auto mt-12 p-6 bg-white rounded shadow",children:[e.jsx("h2",{className:"text-xl font-bold mb-4",children:"Real-Time Model Configuration"}),e.jsxs("div",{className:"config-item mb-4",children:[e.jsx("label",{htmlFor:"voiceSelect",className:"block mb-1 font-medium",children:"Select Voice:"}),e.jsx("select",{id:"voiceSelect",className:"w-full border rounded p-2",value:f.voice,onChange:r=>{console.log("Selected voice:",r.target.value),c(t=>({...t,voice:r.target.value}))},children:y.map(r=>e.jsx("option",{value:r.value,children:r.label},r.value))})]}),e.jsxs("div",{className:"config-item mb-4",children:[e.jsx("label",{htmlFor:"instructionInput",className:"block mb-1 font-medium",children:"Instruction:"}),e.jsx("textarea",{id:"instructionInput",className:"w-full border rounded p-2",value:f.instructions,onChange:r=>{const t=r.target.value.slice(0,1e3);c(x=>({...x,instructions:t}))},placeholder:"e.g. Speak like a kind young programmer with extensive experience."})]}),e.jsx("div",{className:"config-item mb-4",children:e.jsx("button",{className:"px-4 py-2 bg-green-600 text-white rounded hover:bg-green-500",onClick:u,children:"Create Prompt"})}),e.jsxs("div",{className:"config-item mb-4",children:[e.jsx("label",{htmlFor:"micSelect",className:"block mb-1 font-medium",children:"Select Microphone:"}),e.jsx("select",{id:"micSelect",className:"w-full border rounded p-2",value:f.microphoneId,onChange:r=>c(t=>({...t,microphoneId:r.target.value})),children:p.map(r=>e.jsx("option",{value:r.deviceId,children:r.label||"Microphone"},r.deviceId))})]}),e.jsxs("div",{className:"config-item mb-4 flex items-center",children:[e.jsx("input",{id:"micToggle",type:"checkbox",checked:f.startWithMicDisabled,onChange:r=>c(t=>({...t,startWithMicDisabled:r.target.checked})),className:"mr-2"}),e.jsx("label",{htmlFor:"micToggle",className:"font-medium",children:"Start dialogue with microphone disabled"})]}),e.jsx("div",{className:"config-item",children:e.jsx("button",{className:"w-full px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-500",onClick:v,children:"Create Model"})})]})})}const J=({audioContext:f,analyser:c,isMuted:u,aiState:v})=>{const p=s.useRef(null),w=s.useRef(null),y=s.useRef(!0),r=s.useRef([]),t=s.useRef([]),x=s.useRef(v),g=s.useRef(u),i=s.useRef(0),b=s.useRef(1);return s.useEffect(()=>{x.current=v,g.current=u},[v,u]),s.useEffect(()=>{const j=p.current,a=j.getContext("2d");y.current=!0;const k=window.devicePixelRatio||1,m=400,o=m*k,C=m*k;j.width=o,j.height=C,j.style.width=`${m}px`,j.style.height=`${m}px`;const S=Math.PI,E=12;i.current=140*k;const N={x:o/2,y:C/2},I=(n,h,d)=>n*(1-d)+h*d,T=(n,h)=>Math.random()*(h-n)+n,A=(n,h)=>(n%h+h)%h,P=()=>{t.current=[a.createRadialGradient(o/2,C/2,0,o/2,C/2,i.current),a.createLinearGradient(0,0,o,0),a.createLinearGradient(0,0,o,0),a.createLinearGradient(0,0,o,0)],t.current[0].addColorStop(0,"rgba(255,255,255,0.9)"),t.current[0].addColorStop(1,"rgba(255,255,255,0.4)"),t.current[1].addColorStop(0,"#70d7ff"),t.current[1].addColorStop(1,"#a8d8ff"),t.current[2].addColorStop(0,"#d8a8ff"),t.current[2].addColorStop(1,"#e0c3fc"),t.current[3].addColorStop(0,"#ff9be3"),t.current[3].addColorStop(1,"#ffb3e6")},O=()=>{r.current=[];for(let n=0;n<3;n++){const h=[];for(let d=0;d<E;d++){const M=S*2/E*d;h.push({x:N.x+i.current*Math.cos(M),y:N.y+i.current*Math.sin(M),radian:M,range:T(18,25),phase:T(0,S*2),baseRadius:i.current})}r.current.push(h)}},D=(n,h)=>{a.fillStyle=h,a.beginPath(),a.moveTo((n[A(-1,E)].x+n[0].x)/2,(n[A(-1,E)].y+n[0].y)/2);for(let d=0;d<n.length;d++)a.quadraticCurveTo(n[d].x,n[d].y,(n[d].x+n[A(d+1,E)].x)/2,(n[d].y+n[A(d+1,E)].y)/2);a.closePath(),a.fill()},F=()=>{if(!c||!y.current)return 0;const n=new Uint8Array(c.frequencyBinCount);c.getByteFrequencyData(n);const h=n.reduce((d,M)=>d+M,0);return Math.min(h/n.length/255,.5)},l=()=>{if(!y.current)return;const n=F(),h=I(.1,n,1),d=x.current==="thinking"?.95:x.current==="speaking"?1.15:1;b.current=I(b.current,d,.15),a.clearRect(0,0,o,C),a.globalCompositeOperation="screen",a.globalAlpha=.9,a.beginPath(),a.arc(N.x,N.y,i.current*.6,0,2*Math.PI),a.fillStyle=t.current[0],a.fill(),r.current.forEach((M,B)=>{const z=B+1;t.current[z]&&(M.forEach(R=>{const U=1+h*1.5;R.phase+=T(-.05,.05)*b.current*U;let L=i.current*b.current;g.current||(L+=Math.min(h*100*k,50*k));const _=R.range*Math.sin(R.phase*U),$=N.x+(L+_)*Math.cos(R.radian),G=N.y+(L+_)*Math.sin(R.radian);R.x=I(R.x,$,.2),R.y=I(R.y,G,.2),R.radian+=S/320*(1/b.current)}),a.shadowColor="#70d7ff55",a.shadowBlur=20*k,D(M,t.current[z]),a.shadowBlur=0)}),w.current=requestAnimationFrame(l)};return P(),O(),l(),()=>{y.current=!1,cancelAnimationFrame(w.current)}},[c]),e.jsx("canvas",{ref:p,className:"absolute left-1/2 top-1/2 transform -translate-x-1/2 -translate-y-1/2 z-0",style:{imageRendering:"crisp-edges"}})};function V({sessionState:f,toggleMute:c,terminateSession:u,audioContext:v,analyser:p}){const[w,y]=s.useState(300),[r,t]=s.useState("listening");s.useEffect(()=>{const g=setInterval(()=>{y(b=>b>0?b-1:0)},1e3),i=setInterval(()=>{t(b=>{const j=["listening","thinking","speaking"];return j[(j.indexOf(b)+1)%j.length]})},5e3);return()=>{clearInterval(g),clearInterval(i)}},[]),s.useEffect(()=>{w===0&&u()},[w,u]);const x=`${Math.floor(w/60).toString().padStart(2,"0")}:${(w%60).toString().padStart(2,"0")}`;return e.jsxs("div",{className:"session-container relative flex flex-col items-center justify-center h-screen bg-gray-50",children:[e.jsx("div",{className:"absolute top-4 right-4 bg-white px-4 py-2 rounded shadow z-10",children:e.jsx("span",{className:"font-mono",children:x})}),e.jsx("div",{className:"mb-16",children:e.jsx(J,{audioContext:v,analyser:p,isMuted:f.muted,aiState:r})}),e.jsxs("div",{className:"absolute bottom-24 flex gap-4 z-10",children:[e.jsx("button",{className:"p-3 bg-gray-200 hover:bg-gray-300 rounded-full transition-colors shadow-md flex items-center justify-center",onClick:c,children:e.jsx("i",{className:"material-icons text-xl",children:f.muted?"mic_off":"mic"})}),e.jsx("button",{className:"p-3 bg-red-100 hover:bg-red-200 rounded-full transition-colors shadow-md flex items-center justify-center",onClick:u,children:e.jsx("i",{className:"material-icons text-xl",children:"meeting_room"})})]})]})}function H(){const[f,c]=s.useState("menu"),[u,v]=s.useState(""),[p,w]=s.useState({voice:"alloy",instructions:"",microphoneId:"",startWithMicDisabled:!1}),[y,r]=s.useState({status:"idle",muted:!1}),t=s.useRef(null),x=s.useRef(null),g=s.useRef(null),i=s.useRef(null),b=s.useRef(null);async function j(){console.log("Starting Real-Time session with configuration:",p);try{const o=await(await fetch("/token",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({model:"gpt-4o-realtime-preview-2024-12-17",voice:p.voice,instructions:p.instructions})})).json();if(console.log("Token data:",o),o.error)throw new Error("Error creating session: "+JSON.stringify(o.error));if(!o.client_secret)throw new Error("client_secret missing in response: "+JSON.stringify(o));const C=o.client_secret.value,S=new RTCPeerConnection;t.current=S,g.current=document.createElement("audio"),g.current.autoplay=!0,S.ontrack=l=>{l.streams&&l.streams[0]&&(g.current.srcObject=l.streams[0])};const E={audio:p.microphoneId?{deviceId:{exact:p.microphoneId}}:!0},N=await navigator.mediaDevices.getUserMedia(E);p.startWithMicDisabled&&(N.getAudioTracks().forEach(l=>{l.enabled=!1}),r(l=>({...l,muted:!0}))),N.getAudioTracks().forEach(l=>{S.addTrack(l,N)});const I=S.createDataChannel("oai-events");x.current=I,I.onopen=()=>{console.log("Data channel is open")},I.onmessage=l=>{console.log("Data channel message:",l.data)};const T=await S.createOffer();await S.setLocalDescription(T);const A=`https://api.openai.com/v1/realtime?model=${encodeURIComponent(p.model)}`,D={type:"answer",sdp:await(await fetch(A,{method:"POST",headers:{Authorization:`Bearer ${C}`,"Content-Type":"application/sdp"},body:T.sdp})).text()};await S.setRemoteDescription(D),i.current||(i.current=new(window.AudioContext||window.webkitAudioContext)),b.current=i.current.createAnalyser(),b.current.fftSize=256,await(async()=>{const l=i.current.createMediaStreamDestination(),n=await navigator.mediaDevices.getUserMedia({audio:!0});i.current.createMediaStreamSource(n).connect(l),i.current.createMediaElementSource(g.current).connect(l),l.stream.getTracks().forEach(M=>{i.current.createMediaStreamSource(new MediaStream([M])).connect(b.current)})})(),r(l=>({...l,status:"listening..."})),c("session")}catch(m){console.error("Failed to start session:",m),v(m.message)}}async function a(){console.log("Terminating session");try{await fetch("/end",{method:"POST"}),t.current&&(t.current.close(),t.current=null),x.current&&(x.current.close(),x.current=null),i.current&&(await i.current.close(),i.current=null),g.current&&(g.current.pause(),g.current=null)}catch(m){console.error("Error ending session:",m)}r({status:"idle",muted:!1}),c("menu")}function k(){t.current&&t.current.getSenders().forEach(o=>{o.track&&o.track.kind==="audio"&&(o.track.enabled=!o.track.enabled)}),r(m=>({...m,muted:!m.muted})),console.log(y.muted?"Microphone unmuted":"Microphone muted")}return e.jsxs("div",{className:"app-container",children:[u&&e.jsxs("div",{className:"api-error fixed top-4 left-1/2 transform -translate-x-1/2 bg-red-600 text-white px-4 py-2 rounded z-50",children:[u,e.jsx("button",{onClick:()=>v(""),className:"ml-4 text-white font-bold",children:"X"})]}),s.useEffect(()=>{if(u){const m=setTimeout(()=>v(""),5e3);return()=>clearTimeout(m)}},[u]),f==="menu"&&e.jsx(W,{onSelectRealTime:()=>c("configuration")}),f==="configuration"&&e.jsx(q,{config:p,setConfig:w,onCreatePrompt:async()=>{try{const o=await(await fetch("/prompt")).json();w(C=>({...C,instructions:o.instruction})),console.log("Received prompt:",o.instruction)}catch(m){console.error("Failed to fetch prompt:",m)}},onModelCreate:j}),f==="session"&&e.jsx(V,{sessionState:y,toggleMute:k,terminateSession:a,audioContext:i.current,analyser:b.current}),f==="configuration"&&e.jsx("button",{onClick:()=>c("menu"),className:"fixed top-4 left-4 p-2 bg-gray-200 hover:bg-gray-300 rounded-full",title:"Back to main",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10 19l-7-7m0 0l7-7m-7 7h18"})})})]})}function Y(){return e.jsx(H,{})}export{Y as default};
